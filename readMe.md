# For run code
1) npm install
2) npx ts-node hybrid-encryption.ts

# ‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏Ç‡∏≠‡∏á Code 
- ‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏õ‡∏¢‡∏±‡∏á server ‡πÉ‡∏´‡πâ‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢‡πÄ‡∏£‡∏≤‡∏à‡∏∞‡πÉ‡∏ä‡πâ Keypair ‡∏Ñ‡∏∑‡∏≠ ‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡∏´‡∏±‡∏™‡∏ï‡πâ‡∏ô‡∏ó‡∏≤‡∏á‡∏î‡πâ‡∏ß‡∏¢ public key ‡πÅ‡∏•‡∏∞ ‡∏à‡∏∞‡∏ñ‡∏≠‡∏î‡πÑ‡∏î‡πâ‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ private key ‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡∏π‡πà‡∏Å‡∏±‡∏ô ‡πÅ‡∏ï‡πà‡∏Å‡∏≤‡∏£‡∏à‡∏∞‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡∏´‡∏±‡∏™‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ç‡∏ô‡∏≤‡∏î‡πÉ‡∏´‡∏ç‡πà‡∏î‡πâ‡∏ß‡∏¢ keypair ‡πÉ‡∏ä‡πâ‡πÄ‡∏ß‡∏•‡∏≤‡∏ô‡∏≤‡∏ô‡πÅ‡∏•‡∏∞‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡∏ç‡πà‡∏°‡∏≤‡∏Å ‡∏à‡∏∂‡∏á‡∏à‡∏∞‡∏ú‡∏™‡∏°‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡∏´‡∏±‡∏™‡πÅ‡∏ö‡∏ö AES (Advanced Encryption Standard) ‡∏ó‡∏µ‡πà‡∏ó‡∏≥‡πÑ‡∏î‡πâ‡πÑ‡∏ß‡πÅ‡∏•‡∏∞‡πÑ‡∏°‡πà‡∏ã‡∏±‡∏ö‡∏ã‡πâ‡∏≠‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡∏´‡∏±‡∏™‡πÅ‡∏•‡∏∞‡∏ñ‡∏≠‡∏î‡∏£‡∏´‡∏±‡∏™‡∏î‡πâ‡∏ß‡∏¢ key ‡πÄ‡∏î‡∏µ‡∏¢‡∏ß
    1) ‡πÄ‡∏£‡∏≤‡∏à‡∏∞‡πÄ‡∏Ç‡πâ‡∏≤ ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏î‡πâ‡∏ß‡∏¢ AES key ‡∏ã‡∏∂‡πà‡πà‡∏á‡∏õ‡∏•‡∏≤‡∏¢‡∏ó‡∏≤‡∏á‡∏à‡∏∞‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡∏µ‡∏¢‡∏£‡πå‡∏ô‡∏µ‡πâ‡πÄ‡∏£‡∏≤‡∏à‡∏∞‡∏ï‡πâ‡∏≠‡∏á‡∏™‡πà‡∏á‡πÑ‡∏õ‡∏î‡πâ‡∏ß‡∏¢ ‡πÅ‡∏ï‡πà ‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡πÑ‡∏õ‡∏ï‡∏£‡∏á‡πÜ‡∏Å‡πá‡∏à‡∏∞‡πÅ‡∏≠‡∏ö‡∏î‡∏±‡∏Å‡∏•‡∏∞‡πÄ‡∏õ‡∏¥‡∏î‡∏î‡∏π‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ
    2) ‡πÄ‡∏£‡∏≤‡∏à‡∏∞‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡∏´‡∏±‡∏™ key AES ‡∏î‡πâ‡∏ß‡∏¢ public key ‡∏´‡∏£‡∏∑‡∏≠ RSA ‡πÄ‡∏ô‡∏∑‡πà‡∏≠‡∏á‡∏à‡∏≤‡∏Å key ‡∏°‡∏µ‡∏Ç‡∏ô‡∏≤‡∏î‡πÑ‡∏°‡πà‡πÉ‡∏´‡∏ç‡πà‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏ó‡∏≥‡πÑ‡∏î‡πâ ‡πÅ‡∏•‡∏∞ ‡∏Å‡∏≤‡∏£‡∏à‡∏∞‡πÄ‡∏õ‡∏¥‡∏î AES Key ‡πÑ‡∏î‡πâ‡∏Å‡πá‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ private key ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô‡∏ã‡∏∂‡πà‡∏á‡∏≠‡∏¢‡∏π‡πà‡∏ó‡∏µ‡πà‡∏£‡∏∞‡∏ö‡∏ö server

- ‡∏ù‡∏±‡πà‡∏á Server ‡∏à‡∏∞‡πÄ‡∏Ç‡πâ‡∏≤ decrypt AES key ‡πÇ‡∏î‡∏¢‡πÉ‡∏ä‡πâ private key ‡∏ó‡∏µ‡πà‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á‡∏°‡∏µ ‡πÅ‡∏•‡∏∞‡πÉ‡∏ä‡πâ AES decrypt data  ‡∏≠‡∏µ‡∏Å‡∏ó‡∏µ‡∏ô‡∏∂‡∏á

# Code ‡πÅ‡∏ö‡πà‡∏á‡πÄ‡∏õ‡πá‡∏ô 3 ‡∏™‡πà‡∏ß‡∏£
1) ‡∏™‡∏£‡πâ‡∏≤‡∏á RSA keypair ‡πÅ‡∏•‡∏∞ AES key
``` typescript
const pki = forge.pki;
const random = forge.random;
const aes = forge.cipher;
const pki = forge.pki;
const serverKeypair = pki.rsa.generateKeyPair(2048);
```

2) ‡∏ù‡∏±‡πà‡∏á Client ‡∏à‡∏∞‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡∏´‡∏±‡∏™‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏î‡πâ‡∏ß‡∏¢ AES key ‡πÅ‡∏•‡∏∞‡∏™‡πà‡∏á‡πÑ‡∏õ‡∏¢‡∏±‡∏á Server ‡πÅ‡∏•‡∏∞‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡∏´‡∏±‡∏™ AES key ‡∏î‡πâ‡∏ß‡∏¢ public key ‡∏Ç‡∏≠‡∏á server

``` typescript
function EncyptTextFromClient(filePath: string): ClientReq {
    console.log('üîê Encrypting data on client side...');
    // Generate a random AES key (128-bit)
    const aesKey = random.getBytesSync(16); // 16 bytes = 128 bits
    console.log('‚úÖ Generated AES key:');
    const iv = random.getBytesSync(16);     // AES IV

    // Encrypt data with AES key
    const plaintext: string = fs.readFileSync(filePath, 'utf8');
    console.log('üîê PlainText:', plaintext);

    // encrypt data with AES key
    const cipher = aes.createCipher('AES-CBC', aesKey);
    cipher.start({ iv });
    cipher.update(forge.util.createBuffer(plaintext, 'utf8'));
    cipher.finish();
    const encryptedData = cipher.output.getBytes(); // binary
    console.log('‚úÖ Encrypted data:');

    // Encrypt AES key with server's RSA public key
    const encryptedAESKey = serverKeypair.publicKey.encrypt(aesKey, 'RSAES-PKCS1-V1_5');
    const encryptIV = serverKeypair.publicKey.encrypt(iv, 'RSAES-PKCS1-V1_5');
    console.log('‚úÖ Encrypted AES key:');

    console.log({
        encyptedAESKey:forge.util.encode64(encryptedAESKey),
        encryptedData: forge.util.encode64 (encryptedData),
    })

    const request: ClientReq = {
        encyptedAESKey: encryptedAESKey,
        encryptedData: encryptedData,
        iv: encryptIV
    }
    return  request;
}
```

3) ‡∏ù‡∏±‡πà‡∏á Server ‡∏à‡∏∞‡∏ñ‡∏≠‡∏î‡∏£‡∏´‡∏±‡∏™ AES key ‡∏î‡πâ‡∏ß‡∏¢ private key ‡πÅ‡∏•‡∏∞‡∏ñ‡∏≠‡∏î‡∏£‡∏´‡∏±‡∏™‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏î‡πâ‡∏ß‡∏¢ AES key
``` typescript
function serverDecrypt(request: ClientReq){
    console.log('üîê Decrypting AES key and data on server side...');
    //  ‡πÄ‡∏ô‡∏∑‡πà‡∏≠‡∏á‡∏à‡∏≤‡∏Å‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏™‡πà‡∏á‡∏°‡∏≤‡πÄ‡∏õ‡πá‡∏ô base64 log ‡∏ï‡∏£‡∏á‡πÜ‡∏°‡∏±‡∏ô‡∏à‡∏∞ ‡∏á‡∏á
    console.log({
        encyptedAESKey: forge.util.encode64(request.encyptedAESKey),
        encryptedData: forge.util.encode64(request.encryptedData),
    })
   const decryptedAESKey = serverKeypair.privateKey.decrypt(request.encyptedAESKey, 'RSAES-PKCS1-V1_5');
   const decipherAESKeyIV = serverKeypair.privateKey.decrypt(request.iv, 'RSAES-PKCS1-V1_5');
   const data = request.encryptedData;

    // Decrypt data with decrypted AES key
    const decipher = aes.createDecipher('AES-CBC', decryptedAESKey);
    decipher.start({iv: decipherAESKeyIV});
    decipher.update(forge.util.createBuffer(data));
    const success = decipher.finish();

    const decryptedMessage = decipher.output.toString();

    console.log('‚úÖ Decrypted:', decryptedMessage);

}
```
